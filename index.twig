{% set submissionString = '' %}

{% set submissionString = submissionString ~ 'Submitted on: ' ~ webform_token('[webform_submission:created]', webform_submission, [], options) ~ '\n' %}
{% set submissionString = submissionString ~ 'Submitted by: ' ~ webform_token('[webform_submission:user]', webform_submission, [], options) ~ '\n' %}
{% set submissionString = submissionString ~ 'Submitted from: ' ~ webform_token('[webform:title]', webform, [], options) ~ '\n\n' %}

{% set elements_list = 
  [
  'text_area_1',
  'spacebreak',
  'text_area_2',
  'print_text | This should be printed',
  'print_line | bolded'
  ]
%}

{% for element in elements_list %}

  {% set elementSplit = element|split(" | ") %}
  {% set elementSplitLength = elementSplit|length() %} 

  {% if elementSplitLength == 1 %}


    {% set elementName = elementSplit[0] %}

    {% if (elementName != 'spacebreak') and ('webform_submission' not in webform_token('[webform_submission:values:'~elementName~']', webform_submission)) %}
      {% set submissionString = submissionString ~ webform_token('[webform:element:'~elementName~ ':title:html]', webform)|render_html_specialchars ~': ' ~  webform_token('[webform_submission:values:'~elementName~']', webform_submission)|render_html_specialchars ~ '\n' %}

    {% elseif (elementName == 'spacebreak') %}
      {% set submissionString = submissionString ~ '\n' %}
    {% else %}
      {% set submissionString = submissionString ~ '\n' 
      ~ element ~ ' is not a valid key\n' 
      ~ '\n' %}
    {% endif %}

  
  {% elseif elementSplitLength == 2 %}


    {% set command = elementSplit[0] %}
    {% set elementName = elementSplit[1] %}

    {% if command == 'spacebreak' %}
      {% for number in 1..(elementSplit[1] * 1) %}
        {% set submissionString = submissionString ~ '\n' %}
      {% endfor %}

    {% elseif command == 'print_text' %}
      {% set submissionString = submissionString ~ elementName ~ '\n' %}
  
    {% elseif command == 'print_line' %}
      {% if elementName == 'bolded' %}
        {% set submissionString = submissionString ~ '*****\n' %}
      {% endif %}
     
    {% elseif (command != 'spacebreak') and ('webform_submission' not in webform_token('[webform_submission:values:'~elementName~']', webform_submission)) %}
      
      {% if command == 'print_section' %}
        {% if (webform_token('[webform_submission:values:'~elementName~']', webform_submission)|render_html_specialchars) is not empty %}
        {% set submissionString = submissionString ~ webform_token('[webform_submission:values:'~elementName~']', webform_submission)|render_html_specialchars ~ '\n' %}
        {% endif %}

      {% elseif command == 'print_section_title' %}
        {% set submissionString = submissionString ~ webform_token('[webform:element:'~elementName~ ':title]', webform)|render_html_specialchars ~ '\n----\n'  %}

      {% else %}
        {% set submissionString = submissionString ~ '\n' 
        ~ command ~ ' is not a valid command\n'
        ~ '\n' %}
      {% endif %}

    {% else %}
      {% set submissionString = submissionString ~ '\n'
      ~ element ~ ' is not a valid key \n'
      ~ '\n' %}
    {% endif %}


  {% else %}
    {% set submissionString = submissionString ~ '\n' 
    ~ element ~ 'is not a valid format. Use the pattern: "element_key" or "break" or "[command] element_key" or "break [number]"\n'
    ~ '\n' %}

  {% endif %}

{% endfor %}

{% if submissionString|length > 4000 %}
  Note for AST: This submission surpasses the 4,000 character limit. Please see the "Additional Comments" at the bottom of the ticket to see the whole submission.
{% endif %}
The submission has {{ submissionString|length }} characters.

{{ submissionString }}